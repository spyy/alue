<!DOCTYPE html>
<html lang="en" manifest="alueet.net.appcache">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Alue</title>

    <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="css/cover.css" rel="stylesheet" type="text/css" />
    
  </head>

  <body>

    <div class="site-wrapper">

      <div class="site-wrapper-inner">

        <div class="cover-container">

          <div class="masthead clearfix">
            <div class="inner">
              <h3 class="masthead-brand">alueet.net</h3>
              <nav>
                <ul class="nav masthead-nav">                  
                  <li><a href="uusi.html">Uusi alue</a></li>
                  <li><a href="alueet.html">Alueet</a></li>
                </ul>
              </nav>
            </div>
          </div>

          <div class="inner cover">
                <div class="list-group lead text-left" id="alueet">
                    <!-- filled in script -->
                </div>
          </div>

          <div class="mastfoot">
            <div class="inner">
                <p>sami.pyy@gmail.com</p>
            </div>
          </div>

        </div>

      </div>

    </div>
              
    <script>                
        
        var key = getURLParam(window.location, "key");
                        
        if (typeof(Storage) != "undefined") {
            if (key.search("__") == -1) {
                printArea(key);
            } else {
                showModal(key);
            }            
        } else {
            alert("Selaimesi ei tue tietokantaa");
        }                        
        
        function getURLParam (oTarget, sVar) {            
            return decodeURI(oTarget.search.replace(new RegExp("^(?:.*[&\\?]" + encodeURI(sVar).replace(/[\.\+\*]/g, "\\$&") + "(?:\\=([^&]*))?)?.*$", "i"), "$1"));
        }
                
        function printAreaFromTo(key, from, to) {            
            var inner = "";
            
            var i;
            for (i = from; i <= to; i++) {
                var item = window.localStorage.getItem(key + "__" + i);
                var values = item.split(" ");                
                
                if (values.length === 1) {
                    inner += "<a href='modaali.html?key=" + key + "&door=" + i + "' class='list-group-item " + item + "'>" + i + "</a>";                                        
                } else {
                    var color = values[0];
                    var date = values[1];
                    var time = values[2];
                    var content = i + "<span class='badge'>" + date + " " + time + "</span>";
                    inner += "<a href='modaali.html?key=" + key + "&door=" + i + "' class='list-group-item " + color + "'>" + content + "</a>";
                    
                }                
            }
            
            document.getElementById("alueet").innerHTML += inner;            
        }
        
        function printArea(key) {
            var inner = "<a href='#' class='list-group-item active'>" + key + "</a>";
            document.getElementById("alueet").innerHTML += inner;
            
            var from = window.localStorage.getItem(key);
            var to = window.localStorage.getItem(key + "_to");
            printAreaFromTo(key, from, to);
        }
                
    </script> 
      
  </body>
</html>