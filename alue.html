<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <link rel="icon" href="favicon.ico">
    
    <title>Alueet</title>

    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="bootstrap/css/cover2.css" rel="stylesheet" type="text/css">
    
  </head>

  <body>

    <div class="site-wrapper">

      <div class="site-wrapper-inner">

        <div class="cover-container">

          <div class="masthead">
            <div class="inner">
                <h3 class="masthead-brand" id="brand">alueet.net</h3>
              <nav>
                <ul class="nav masthead-nav">                  
                  <li><a href="uusi.html">Uusi alue</a></li>
                  <li><a href="alueet.html">Alueet</a></li>
                </ul>
              </nav>
            </div>
          </div>

          <div class="inner cover">
                <div class="list-group lead text-left" id="alueet">
                    <!-- filled in script -->
                </div>
          </div>

        </div>

      </div>

    </div>
      
    <!-- Modal -->
    <div class="modal fade bs-example-modal-sm" id="myModal">
      <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title" id="otsikko" style="color:#325e60"></h4>
            </div>
          <div class="modal-body">
            <div class="list-group lead" id="koodit">
                <!-- filled in script -->
            </div>
          </div>          
        </div>
      </div>
    </div>
              
    <script>                
        
        var key = getURLParam(window.location, "key");
                        
        if (typeof(Storage) != "undefined") {
            if (key.search("__") == -1) {
                printArea();
            }           
        } else {
            alert("Selaimesi ei tue tietokantaa");
        }                        
        
        function getURLParam (oTarget, sVar) {            
            return decodeURI(oTarget.search.replace(new RegExp("^(?:.*[&\\?]" + encodeURI(sVar).replace(/[\.\+\*]/g, "\\$&") + "(?:\\=([^&]*))?)?.*$", "i"), "$1"));
        }
                
        function printAreaFromTo(from, to) {
            var inner = "";
            
            var i;
            for (i = Number(from); i <= Number(to); i++) {
                var item = window.localStorage.getItem(key + "__" + i);
                var values = item.split(" ");                
                
                if (values.length === 1) {
                    inner += "<a href='#' class='list-group-item " + item + "' onclick='showModal(" + i + ");return false;'>" + i + "</a>";        
                } else {
                    var color = values[0];
                    var date = values[1];
                    var time = values[2];
                    var content = i + "<span class='badge'>" + date + " " + time + "</span>";
                    inner += "<a href='#' class='list-group-item " + color + "' onclick='showModal(" + i + ");return false;'>" + content + "</a>";
                    
                }                
            }
            
            document.getElementById("alueet").innerHTML += inner;            
        }
        
        function printArea() {
            var inner = "<a href='#' class='list-group-item active'>" + key + "</a>";
            document.getElementById("alueet").innerHTML = inner;
            
            var from = window.localStorage.getItem(key);
            var to = window.localStorage.getItem(key + "_to");
            printAreaFromTo(from, to);
        }
        
        function showModal(door) {
            printModal(door);
            $("#myModal").modal("show");
        }
        
        function printModal(door) {
            var inner = "";    
            
            inner += "<a href='merkitse.html?key=" + key + "&door=" + door + "&value=list-group-item-success' class='list-group-item list-group-item-success'>Vihreä</a>";
            inner += "<a href='merkitse.html?key=" + key + "&door=" + door + "&value=list-group-item-info' class='list-group-item list-group-item-info'>Sininen</a>";
            inner += "<a href='merkitse.html?key=" + key + "&door=" + door + "&value=list-group-item-warning' class='list-group-item list-group-item-warning'>Keltainen</a>";
            inner += "<a href='merkitse.html?key=" + key + "&door=" + door + "&value=list-group-item-danger' class='list-group-item list-group-item-danger'>Punainen</a>";
            inner += "<a href='merkitse.html?key=" + key + "&door=" + door + "&value=empty' class='list-group-item'>Tyhjä</a>";            
                        
            document.getElementById("koodit").innerHTML = inner;
            
            document.getElementById("otsikko").innerHTML = key + " A " + door;
        }
                
    </script>
    
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
      
  </body>
</html>