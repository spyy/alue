<!DOCTYPE html>
<html lang="en" manifest="alueet.net.appcache">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <link rel="icon" href="favicon.ico">
    
    <title>Alueet</title>

    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="bootstrap/css/cover.css" rel="stylesheet" type="text/css">
    
        
    <script>
        function getURLParam (oTarget, sVar) {            
            return decodeURI(oTarget.search.replace(new RegExp("^(?:.*[&\\?]" + encodeURI(sVar).replace(/[\.\+\*]/g, "\\$&") + "(?:\\=([^&]*))?)?.*$", "i"), "$1"));
        }
    </script>
  </head>

  <body>

    <div class="site-wrapper">

      <div class="site-wrapper-inner">

        <div class="cover-container">

          <div class="masthead clearfix">
            <div class="inner">
              <h3 class="masthead-brand">alueet.net</h3>
              <nav>
                <ul class="nav masthead-nav">                  
                  <li><a href="uusi.html">Uusi alue</a></li>
                  <li><a href="alueet.html">Alueet</a></li>
                </ul>
              </nav>
            </div>
          </div>

          <div class="inner cover">
                <div class="list-group lead text-left" id="alueet">                                                            
                    <!-- filled in script -->                        
                </div>
          </div>

          <div class="mastfoot">
            <div class="inner">
                <p>sami.pyy@gmail.com</p>
            </div>
          </div>

        </div>

      </div>

    </div>
      
    <!-- Modal -->
    <div class="modal fade bs-example-modal-sm" id="myModal">
      <div class="modal-dialog modal-sm">
        <div class="modal-content">          
          <div class="modal-body">
            <div class="list-group lead" id="koodit">
                <!-- filled in script -->
            </div>
          </div>          
        </div>
      </div>
    </div>
    
    <script>
        
        var key = getURLParam(window.location, "key");
        var door = getURLParam(window.location, "door");        
                      
        if (typeof(Storage) != "undefined") {
            if (key.search("__") == -1) {               
                printArea(key);
                printColors(key, door);
            } else {
                showModal(key);
            }            
        } else {
            alert("Selaimesi ei tue tietokantaa");
        }    
                
        function printColors(key, door) {
            var inner = "";    
            
            inner += "<a href='merkitse.html?key=" + key + "&door=" + door + "&value=list-group-item-success' class='list-group-item list-group-item-success'>Vihreä</a>";
            inner += "<a href='merkitse.html?key=" + key + "&door=" + door + "&value=list-group-item-info' class='list-group-item list-group-item-info'>Sininen</a>";
            inner += "<a href='merkitse.html?key=" + key + "&door=" + door + "&value=list-group-item-warning' class='list-group-item list-group-item-warning'>Keltainen</a>";
            inner += "<a href='merkitse.html?key=" + key + "&door=" + door + "&value=list-group-item-danger' class='list-group-item list-group-item-danger'>Punainen</a>";
            inner += "<a href='merkitse.html?key=" + key + "&door=" + door + "&value=empty' class='list-group-item'>Tyhjä</a>";            
                        
        
            document.getElementById("koodit").innerHTML += inner;
        }
                
        function printAreaFromTo(key, from, to) {            
            var inner = "";
            
            var i;
            for (i = from; i <= to; i++) {
                var item = window.localStorage.getItem(key + "__" + i);
                var values = item.split(" ");                
                
                if (values.length === 1) {
                    inner += "<a href='modaali.html?key=" + key + "&door=" + i + "' class='list-group-item " + item + "'>" + i + "</a>";                                        
                } else {
                    var color = values[0];
                    var date = values[1];
                    var time = values[2];
                    var content = i + "<span class='badge'>" + date + " " + time + "</span>";
                    inner += "<a href='modaali.html?key=" + key + "&door=" + i + "' class='list-group-item " + color + "'>" + content + "</a>";
                    
                }                
            }
            
            document.getElementById("alueet").innerHTML += inner;            
        }
        
        function printArea(key) {
            var inner = "<a href='#' class='list-group-item active'>" + key + "</a>";
            document.getElementById("alueet").innerHTML += inner;
            
            var from = window.localStorage.getItem(key);
            var to = window.localStorage.getItem(key + "_to");
            printAreaFromTo(key, from, to);
        }      
                        
    </script>
    
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="bootstrap/js/bootstrap.min.js"></script>
    
    <script>$(window).load(function(){$('#myModal').modal('show');});</script>
    
  </body>
</html>